<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Timetable</title>
  <style>
    :root{--grid-color:#d3d3d3;--bg:#808080}
    html,body{height:100%;margin:0}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background-color: var(--bg);
      background-image:
        linear-gradient(var(--grid-color) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
      background-size:50px 50px,50px 50px;
      color:#111;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:20px;
      box-sizing:border-box;
    }
    .wrap{max-width:1100px;margin:0 auto;background:rgba(255,255,255,0.9);padding:16px;border-radius:8px}
    h1{margin:0 0 12px}
    #timetable{overflow:auto}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #ccc;padding:6px;text-align:center}
    th{background:#f3f3f3}
    .controls{margin:8px 0}
    button{padding:8px 12px;font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Timetable</h1>
    <div class="controls">
      <button id="exportBtn">Export JSON</button>
    </div>
    <div id="timetable" role="region" aria-label="Weekly timetable"></div>
  </div>

  <script>
    // setup will be executed when the HTML file is loaded
    function setup(){
      buildTimetable();
      document.getElementById('exportBtn').addEventListener('click', exportTimetable);
      console.log('setup executed: timetable built');
    }

    function buildTimetable(){
      const days = ['Time','Mon','Tue','Wed','Thu','Fri'];
      const startHour = 8;
      const endHour = 18;
      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const headRow = document.createElement('tr');
      days.forEach(d=>{const th=document.createElement('th');th.textContent=d;headRow.appendChild(th)});
      thead.appendChild(headRow);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');
      for(let h=startHour;h<endHour;h++){
        const tr = document.createElement('tr');
        const timeCell = document.createElement('td');
        timeCell.textContent = h+':00';
        tr.appendChild(timeCell);
        for(let d=1;d<days.length;d++){
          const td = document.createElement('td');
          td.contentEditable = 'true';
          td.setAttribute('data-day', d);
          td.setAttribute('data-hour', h);
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      table.appendChild(tbody);
      const container = document.getElementById('timetable');
      container.innerHTML = '';
      container.appendChild(table);
    }

    function exportTimetable(){
      const rows = Array.from(document.querySelectorAll('#timetable tbody tr'));
      const data = rows.map(r=>{
        const hour = r.querySelector('td').textContent;
        const cells = Array.from(r.querySelectorAll('td')).slice(1).map(td=>td.textContent.trim());
        return {hour, cells};
      });
      const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'timetable.json'; document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    // run setup when loaded
    window.addEventListener('DOMContentLoaded', setup);
  </script>
</body>
</html>
